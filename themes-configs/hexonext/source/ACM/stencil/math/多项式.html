<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="/ACM/js/link.js"></script>
    <title>多项式</title>
</head>


<script type="text/javascript" src="/ACM/js/web_begin.js"></script>
<div>
    <center>
        <h1>多项式</h1>
    </center>
    <div id="text">
        <h2>多项式</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        多项式在计算机中一般以数组方式储存，假设有一个多项式f(x)，并且x^i前面的系数为ai，那么显然我们恰好可以用一个数组a来描述这个多项式，
        多项式的系数ai恰好存在数组a的第i项a[i]；<br>


        <h2>多项式dft</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        在一般的多项式中，如果模数允许，乘法采取ntt来做，因为速度较快，多项式乘法是整个多项式体系的基石，他的常数如果太大，将影响到后面的所
        有的多项式操作，

        <h2>多项式前期预处理</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        我们需要设置多项式最大长度，模数，原根，多项式最大长度的log，以及关键点reduce函数，传入一个-mod到mod之间的数x，返回x%mod,他比取模更快
        然后是快速幂，在往后是复数i在模意义下的值，2i在模意义下的逆元,以及后面的逆元数组和他的初始化函数
        <div id="code">
            <pre><span class="k">const</span> <span class="kt">int</span> <span class="n">maxn</span><span class="o">=</span><span class="mi">100005</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span><span class="n">mod</span> <span class="o">=</span> <span class="mi">998244353</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="c1">// const 能明显加速代码</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">lgmaxn</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
<span class="cp">#define reduce(x) ((x)+(((x)&gt;&gt;31)&amp;mod))</span>

<span class="kt">int</span> <span class="n">qpow</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">ret</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">b</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span> <span class="n">ret</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">ret</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="n">a</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">I</span><span class="o">=</span><span class="mi">86583718</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">inv2</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">inv2I</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">inv</span><span class="p">[</span><span class="n">maxn</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>
<span class="kt">void</span> <span class="n">inv_ini</span><span class="p">(){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">maxn</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">mod</span><span class="o">-</span><span class="n">mod</span><span class="o">/</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">inv</span><span class="p">[</span><span class="n">mod</span><span class="o">%</span><span class="n">i</span><span class="p">])</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>
</pre>
        </div>

        <h2>dft</h2>
        蝴蝶变化必须预处理出来，否则太慢，最前面的是蝴蝶变换r[i][j]数组， 之后是ntt单位根wn数组和他的逆元数组。接着是ntt的数组的预处理函数以及ntt函数本体
        <div id="code">
            <pre><span class="kt">int</span> <span class="n">allr</span><span class="p">[</span><span class="n">maxn</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">],</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span><span class="n">ntt_wn</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span><span class="n">ntt_revwn</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span> <span class="c1">// 特别详细，没啥其他可说的 </span>
<span class="c1">//https://wenku.baidu.com/view/b438a51cce84b9d528ea81c758f5f61fb7362826.html</span>
<span class="kt">void</span> <span class="n">dft_ini</span><span class="p">(){</span> <span class="c1">// ntt 高性能</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">allr</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">n</span><span class="o">&lt;</span><span class="n">maxn</span><span class="p">;</span><span class="n">n</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="p">][</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="p">((</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">bit</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">+</span><span class="n">n</span><span class="p">;</span>
        <span class="n">ntt_wn</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">g</span><span class="p">,(</span><span class="n">mod</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="n">bit</span><span class="p">);</span><span class="c1">// 单位根</span>
        <span class="n">ntt_revwn</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">ntt_wn</span><span class="p">[</span><span class="n">bit</span><span class="p">],</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span><span class="c1">//逆变换则乘上逆元</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">dft</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">bits</span><span class="p">,</span><span class="kt">int</span> <span class="n">opt</span><span class="p">){</span> <span class="c1">// ntt </span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">r</span><span class="p">[</span><span class="n">bits</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">bits</span><span class="p">][</span><span class="n">i</span><span class="p">]]);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">wn</span><span class="o">=</span><span class="n">opt</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="n">ntt_wn</span><span class="p">[</span><span class="n">bit</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="n">ntt_revwn</span><span class="p">[</span><span class="n">bit</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">+=</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)){</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">k</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">wn</span><span class="o">%</span><span class="n">mod</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">-</span><span class="n">mod</span><span class="p">),</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span><span class="c1">//1800ms+</span>
</pre>
        </div>

        <h2>多项式拓展与对齐</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        为了后期代码可观性良好，以及少写一些奇怪的代码，poly_cpy(int*a,int n,int*b,int exn)提供了多项式拷贝等操作，即将一个多项式拷贝到另外一个
        多项式，必须保证exn>=n ，即先将a[0...n-1]拷贝到b[0...n-1] 然后把b数组多余的部分清零。这里如果ab为同一个数组，就不必进行拷贝了。
        <div id="code">
            <pre><span class="kt">void</span> <span class="n">poly_cpy</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">exn</span><span class="p">){</span><span class="c1">//</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">!=</span><span class="n">b</span><span class="p">)</span>  <span class="n">memcpy</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="n">exn</span><span class="p">)</span> <span class="n">memset</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">exn</span><span class="o">-</span><span class="n">n</span><span class="p">));</span>
<span class="p">}</span>
</pre>
        </div>


        <h2>多项式乘法</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        为了防止常数问题，这里依旧采取最简单的方式，不让数组发生过多的拷贝，我们只实现a*=b这一个步骤，不实现c=a*b这种，很套路的乘法，先变为点指表示法
        然后变为系数表示法即可
        <div id="code">
            <pre><span class="kt">void</span> <span class="n">poly_mul</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">na</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">nb</span><span class="p">){</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">exn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">exn</span><span class="o">&lt;</span><span class="n">na</span><span class="o">+</span><span class="n">nb</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">exn</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">++</span><span class="p">;</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">na</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">exn</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre>
        </div>

        <h2>多项式求逆</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        若两个多项式f和g，求出f*g然后让系数对mod取模，多项式忽略高于x^k次的项后等于1，则f和g互逆<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        这个地方很难以理解，因为有两个取模，所以会让很多初学者感到困惑，只要注意两个模是不同的，一个是系数对mod取模，另一个是多项式整体对x^k取模，即可
        整个算法采取牛顿迭代法来完成，很容易被数学归纳法证明，f(x)*g(x)===1(x^k,mod),当k等于1的时候，非常好得出结果，显然那时候g(x)至少需要
        1项，即常数项，大于常数项的部分无效的，这个很容易证明，这一项等于f(x)的常数项的逆元。然后我们来根据f(x)*g(x)===1(x^k,mod)推出f(x)*g(x)===1(x^2k,mod)
        的结果,以下是推导过程,显然g(x)=g(x)*(2-f(x)*g(x)),只要自己注意一下项数的变化即可，然后我们倍增即可得出答案时间复杂度T(n)=T(n/2)+nlg(n)
        根据主定理T(n)=O(nlgn)
        <!--\\-->
        <!--f(x)*g(x)\equiv 1 \% (x^k)\\-->
        <!--f(x)*g(x)-1\equiv 0\% (x^k)\\-->
        <!--(f(x)*g(x)-1)^2\equiv 0 \%(x^{2k})\\-->
        <!--f(x)*f(x)*g(x)*g(x)-2f(x)*g(x)+1\equiv 0\% (x^{2k})\\-->
        <!--f(x)*g(x)*(2-f(x)*g(x))\equiv 1\%(x^{2k})\\-->
        <img src="/ACM/多项式求逆.png" style="width: 80%;">
        <div id="code">
            <pre><span class="kt">void</span> <span class="n">poly_inv</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span> <span class="c1">//  // %(x^n)  b(2-ab)</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="k">return</span><span class="p">;}</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">exn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">exn</span><span class="o">&lt;</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">exn</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">++</span><span class="p">;</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">exn</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">1ll</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span><span class="c1">//p4738 开O2 500ms+ 洛谷最快200ms+</span>
</pre>
        </div>

        <h2>多项式除法</h2>
        <!--\\-->
        <!--\frac{a(x)}{b(x)}=c(x)...d(x)\\-->
        <!--b(x)c(x)+d(x)=a(x)\\-->
        <!--b(\frac{1}{x})c(\frac{1}{x})+d(\frac{1}{x})=a(\frac{1}{x})\\-->
        <!--x^mb(\frac{1}{x})x^{n-m}c(\frac{1}{x})+x^{n-m+1}x^{m-1}d(\frac{1}{x})=x^na(\frac{1}{x})\\-->
        <!--B(x)C(x)+x^{n-m+1}D(x)=A(x)-->

        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        除法会有剩余，所以有两个返回值。<br>
        对于一个n-1次多项式f(x) 定义F(x)=x^nf(1/x) 则有以下推导
        <img src="/ACM/img/多项式除法.png" style="width: 80%;"><br>
        f到F只不过是系数翻转 我们可以通过求逆迅速计算D(x) 继而的得到d(x)
        余数直接ntt暴力即可
        <div id="code">
            <pre><span class="kt">void</span> <span class="n">poly_div</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">na</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">nb</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">d</span><span class="p">){</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">na</span><span class="p">);</span> <span class="n">reverse</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="n">nb</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">);</span> <span class="c1">//exn(2*na-2*nb+1)=exn(2*na-nb-nb+1)</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">na</span><span class="p">);</span> <span class="c1">//exn(na-nb+1+na-1)=exn(2*na-nb)</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">na</span><span class="p">);</span> <span class="n">reverse</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="n">nb</span><span class="p">);</span>

    <span class="n">reverse</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">nb</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">na</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span><span class="c1">// p4738 开O2 600ms+ 洛谷最快300ms+</span>
</pre>
        </div>

        <h2>多项式取对数</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <img src="/ACM/img/多项式求对数.png" style="width: 40%;"><br>
        于是求导、求逆、乘、积分即可完成
        <div id="code">
            <pre><span class="kt">void</span> <span class="n">poly_der</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span> <span class="c1">// 微分求导</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">poly_int</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span> <span class="c1">// 默认积分结果项常的数为0</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">poly_ln</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">// a[exn(n+n-1)] //保证f(0)=1 , 默认积分结果项常的数为0 ，b[0]=ln(a[0])=1</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="n">poly_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">);</span> <span class="c1">// n-1 </span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span> <span class="c1">// n</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_int</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span> <span class="c1">// b[0]=ln(a[0])=ln(1)=0</span>
<span class="p">}</span><span class="c1">//p4725 开O2 700ms+ 洛谷最快300ms+</span>
</pre>
        </div>



        <h2>多项式求指数函数</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        大佬已将讲的很清楚了，用泰勒展开求的
        <img src="https://i.loli.net/2018/10/07/5bb95f11da48a.png" style="width: 80%">
        <pre><span class="kt">void</span> <span class="n">poly_exp</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] // 保证f(0)=0 b(1-ln(b)+f), </span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">a_lnb</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="k">return</span><span class="p">;}</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_ln</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a_lnb</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">a_lnb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">a_lnb</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">a_lnb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">a_lnb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">mod</span><span class="p">);</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a_lnb</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span><span class="c1">//p4726 开O2 1600ms+ 洛谷最快400ms+</span>
</pre>

        <h2>多项式开根</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        递归边界改为二次剩余即可
        <!--g(x) \equiv \sqrt{f(x)} \% (x^k)\\-->
        <!--G(x) \equiv \sqrt{f(x)} \% (x^{2k})\\-->
        <!--G(x)-g(x) \equiv 0  \% (x^k)\\-->
        <!--(G(x)-g(x))^2 \equiv 0  \% (x^{2k})\\-->
        <!--G(x)G(x)+g(x)g(x)-2g(x)G(x) \equiv 0  \% (x^{2k})\\-->
        <!--f(x)+g(x)g(x)-2g(x)G(x) \equiv 0  \% (x^{2k})\\-->
        <!--2g(x)G(x) \equiv f(x)+g(x)g(x) \% (x^{2k})\\-->
        <!--G(x) \equiv \frac{f(x)+g(x)g(x)}{2g(x)} \% (x^{2k})\\-->
        <img src="/ACM/img/多项式开根.png" style="width: 80%;">
        <div id="code">
            <pre><span class="kt">void</span> <span class="n">poly_sqrt</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] //保证a[0]=1, (b+a/b)/2 比上面那个好一些 </span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="k">return</span><span class="p">;}</span>
    <span class="n">poly_sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">inv2</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">inv2</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span><span class="c1">// P5205 开O2 3200+ms 洛谷最快600ms++</span>
</pre>
        </div>


        <h2>多项式快速幂</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        先取对数，然后乘，然后取exp
        <pre><span class="kt">void</span> <span class="n">poly_pow</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] // a^k not quick pow but quicker</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">t</span><span class="o">&lt;</span><span class="n">n</span><span class="o">&amp;&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="n">t</span><span class="o">++</span><span class="p">;</span><span class="c1">// a[t]*x^t</span>
    <span class="k">if</span><span class="p">(</span><span class="mi">1ll</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">k</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span><span class="k">return</span><span class="p">;</span> <span class="c1">//k*t 居然能够爆int</span>
    <span class="n">a</span><span class="o">+=</span><span class="n">t</span><span class="p">;</span><span class="c1">// a/=x^t</span>
    <span class="kt">int</span> <span class="n">invat</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">mul</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">-</span><span class="n">t</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">invat</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">t</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">poly_ln</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">k</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">k</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1ll</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">mul</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="c1">// b*=x^kt</span>
<span class="p">}</span><span class="c1">// 若k为大数，且保证a[0]=1，传入k%mod即可</span>
</pre>


        <h2>多项式三角函数</h2>
        <!--\\-->
        <!--sin(f(x))=\frac{e^{if(x)}-e^{-if(x)}}{2i}\\-->
        <!--cos(f(x))=\frac{e^{if(x)}+e^{-if(x)}}{2}\\-->
        <!--asin(f(x))=\int{\frac{f'(x)}{\sqrt{1-f(x)^2}}}dx\\-->
        <!--atan(f(x))=\int{\frac{f'(x)}{1+f(x)^2}}dx\\-->
        <img src="/ACM/img/多项式三角函数.png" style="width: 80%;">
        <div id="code">
            <pre><span class="kt">void</span> <span class="n">poly_sin</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)]// 保证a[0]=0 -&gt; c[0]=0 -&gt; 可以exp</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">*</span><span class="n">inv2I</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">//  P5264 开O2 2111ms 洛谷最快691ms</span>

<span class="kt">void</span> <span class="n">poly_cos</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)]// 保证a[0]=0 -&gt; c[0]=0 -&gt; 可以exp</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span><span class="c1">//  P5264 开O2 2111ms 洛谷最快691ms</span>

<span class="kt">void</span> <span class="n">poly_asin</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)]// 保证a[0]=0 积分： f&#39;/(sqrt(1-f*f))</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f*f</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="c1">// f*f-1 </span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">mod</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="c1">//1-ff</span>
    <span class="n">poly_sqrt_Strong</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="c1">// sqrt(1-ff)</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span> <span class="c1">// 1/sqrt(1-ff)</span>
    <span class="n">poly_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="c1">// f&#39;</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">//</span>
    <span class="n">poly_int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">// f&#39;/(sqrt(1-f*f))</span>
<span class="p">}</span><span class="c1">// P5265 开O2 1626ms 洛谷最快985ms</span>

<span class="kt">void</span> <span class="n">poly_atan</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] // 保证a[0]=0 积分： f&#39;/(sqrt(1-f*f))</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f*f</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">mod</span><span class="p">);</span><span class="c1">// f*f+1 </span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span> <span class="c1">// 1/(f*f+1)</span>
    <span class="n">poly_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">// f&#39;</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">//</span>
    <span class="n">poly_int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">// f&#39;/(f*f+1)</span>
<span class="p">}</span><span class="c1">// P5265 开O2 1626ms 洛谷最快985ms</span>
</pre>
        </div>

        <h2>拉格朗日插值法</h2>
        。。。。。。没啥可说的，存粹的套路

        <h2>多项式多点求值</h2>





        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <h2>完整代码</h2>
        <div id="code">
            <pre><span class="cp">#include&lt;bits/stdc++.h&gt;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">maxn</span><span class="o">=</span><span class="mi">100005</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span><span class="n">mod</span> <span class="o">=</span> <span class="mi">998244353</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="c1">// const 能明显加速代码</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">lgmaxn</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
<span class="cp">#define reduce(x) ((x)+(((x)&gt;&gt;31)&amp;mod))</span>

<span class="kt">int</span> <span class="n">qpow</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">ret</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">b</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span> <span class="n">ret</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">ret</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="n">a</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">I</span><span class="o">=</span><span class="mi">86583718</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">inv2I</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">inv</span><span class="p">[</span><span class="n">maxn</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>
<span class="kt">void</span> <span class="n">inv_ini</span><span class="p">(){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">maxn</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">mod</span><span class="o">-</span><span class="n">mod</span><span class="o">/</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">inv</span><span class="p">[</span><span class="n">mod</span><span class="o">%</span><span class="n">i</span><span class="p">])</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">allr</span><span class="p">[</span><span class="n">maxn</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">],</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span><span class="n">ntt_wn</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span><span class="n">ntt_revwn</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span> <span class="c1">// 特别详细，没啥其他可说的 </span>
<span class="c1">//https://wenku.baidu.com/view/b438a51cce84b9d528ea81c758f5f61fb7362826.html</span>
<span class="kt">void</span> <span class="n">dft_ini</span><span class="p">(){</span> <span class="c1">// ntt 高性能</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">allr</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">n</span><span class="o">&lt;</span><span class="n">maxn</span><span class="p">;</span><span class="n">n</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="p">][</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="p">((</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">bit</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">+</span><span class="n">n</span><span class="p">;</span>
        <span class="n">ntt_wn</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">g</span><span class="p">,(</span><span class="n">mod</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="n">bit</span><span class="p">);</span><span class="c1">// 单位根</span>
        <span class="n">ntt_revwn</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">ntt_wn</span><span class="p">[</span><span class="n">bit</span><span class="p">],</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span><span class="c1">//逆变换则乘上逆元</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">dft</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">bits</span><span class="p">,</span><span class="kt">int</span> <span class="n">opt</span><span class="p">){</span> <span class="c1">// ntt </span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">r</span><span class="p">[</span><span class="n">bits</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">bits</span><span class="p">][</span><span class="n">i</span><span class="p">]]);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bit</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">wn</span><span class="o">=</span><span class="n">opt</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="n">ntt_wn</span><span class="p">[</span><span class="n">bit</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="n">ntt_revwn</span><span class="p">[</span><span class="n">bit</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">+=</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)){</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">k</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">wn</span><span class="o">%</span><span class="n">mod</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">-</span><span class="n">mod</span><span class="p">),</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span><span class="c1">//1800ms+</span>

<span class="kt">void</span> <span class="n">poly_show</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot; %dx^%d +&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1000</span><span class="o">?</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="nl">mod:</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">);</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">poly_cpy</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">exn</span><span class="p">){</span><span class="c1">//</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">!=</span><span class="n">b</span><span class="p">)</span>  <span class="n">memcpy</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="n">exn</span><span class="p">)</span> <span class="n">memset</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">exn</span><span class="o">-</span><span class="n">n</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* </span>
<span class="cm"> a会被作拓展，但是b不会，所以b的范围不会改变</span>
<span class="cm"> a[exn(na+nb-1)] </span>
<span class="cm"> a*=b a和b允许是同一个数组</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="n">poly_mul</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">na</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">nb</span><span class="p">){</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">exn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">exn</span><span class="o">&lt;</span><span class="n">na</span><span class="o">+</span><span class="n">nb</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">exn</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">++</span><span class="p">;</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">na</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">exn</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/*</span>
<span class="cm">b会被作拓展，但是a不会，所以a数组传入没有任何数组大小的要求</span>
<span class="cm">b[exn(n+n-1)]</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="n">poly_inv</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span> <span class="c1">//  // %(x^n)  b(2-ab)</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="k">return</span><span class="p">;}</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">exn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">exn</span><span class="o">&lt;</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">exn</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">bits</span><span class="o">++</span><span class="p">;</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">exn</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">1ll</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">dft</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">exn</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span><span class="c1">//p4738 开O2 500ms+ 洛谷最快200ms+</span>


<span class="cm">/*</span>
<span class="cm">a/b=c...d</span>
<span class="cm">只有cb有要求exn(2*na-nb)</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="n">poly_div</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">na</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">nb</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">d</span><span class="p">){</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">na</span><span class="p">);</span> <span class="n">reverse</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="n">nb</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">);</span> <span class="c1">//exn(2*na-2*nb+1)=exn(2*na-nb-nb+1)</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">na</span><span class="p">);</span> <span class="c1">//exn(na-nb+1+na-1)=exn(2*na-nb)</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">na</span><span class="p">);</span> <span class="n">reverse</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="n">nb</span><span class="p">);</span>

    <span class="n">reverse</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">na</span><span class="o">-</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">nb</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">na</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span><span class="c1">// p4738 开O2 600ms+ 洛谷最快300ms+</span>

<span class="kt">void</span> <span class="n">poly_der</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span> <span class="c1">// 微分求导</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">poly_int</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span> <span class="c1">// 默认积分结果项常的数为0</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">poly_ln</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">// a[exn(n+n-1)] //保证f(0)=1 , 默认积分结果项常的数为0 ，b[0]=ln(a[0])=1</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="n">poly_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">);</span> <span class="c1">// n-1 </span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span> <span class="c1">// n</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_int</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span> <span class="c1">// b[0]=ln(a[0])=ln(1)=0</span>
<span class="p">}</span><span class="c1">//p4725 开O2 700ms+ 洛谷最快300ms+</span>

<span class="kt">void</span> <span class="n">poly_exp</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] // 保证f(0)=0 b(1-ln(b)+f), </span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">a_lnb</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="k">return</span><span class="p">;}</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_ln</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a_lnb</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">a_lnb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">a_lnb</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">a_lnb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">a_lnb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">mod</span><span class="p">);</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a_lnb</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span><span class="c1">//p4726 开O2 1600ms+ 洛谷最快400ms+</span>

<span class="kt">void</span> <span class="n">poly_sqrt</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] //保证a[0]=1, (b+a/b)/2 比上面那个好一些 </span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="k">return</span><span class="p">;}</span>
    <span class="n">poly_sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">inv2</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">inv2</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span><span class="c1">// P5205 开O2 3200+ms 洛谷最快600ms++</span>

<span class="kt">int</span> <span class="n">sqrt_residue</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">){</span> <span class="c1">// return sqrt(a)</span>
    <span class="kt">int</span> <span class="n">b</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>   <span class="c1">//找一个非二次剩余数 b</span>
    <span class="k">while</span><span class="p">(</span><span class="n">qpow</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">mod</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="n">mod</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">b</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">s</span><span class="o">=</span><span class="n">mod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="c1">// mod-1 =2^t*s = s&lt;&lt;t</span>
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">))</span> <span class="n">s</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">++</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">inv</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">),</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">t</span><span class="o">-</span><span class="n">k</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">){</span> <span class="c1">//</span>
        <span class="kt">int</span> <span class="n">invxx</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">inv</span><span class="o">*</span><span class="n">x</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">x</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">qpow</span><span class="p">(</span><span class="n">invxx</span><span class="p">,</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">==</span><span class="n">mod</span><span class="o">-</span><span class="mi">1</span><span class="p">){</span>
            <span class="n">x</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">poly_sqrt_Strong</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] //强化版 不保证a[0]=1 但保证a[0]为二次剩余</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">sqrt_residue</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="k">return</span><span class="p">;}</span><span class="c1">// 其实就这一行不一样</span>
    <span class="n">poly_sqrt_Strong</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">b</span><span class="p">,(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span><span class="c1">// 开O2跑1900ms+ 洛谷最快800ms++</span>

<span class="kt">void</span> <span class="n">poly_pow</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] // a^k not quick pow but quicker</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">t</span><span class="o">&lt;</span><span class="n">n</span><span class="o">&amp;&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="n">t</span><span class="o">++</span><span class="p">;</span><span class="c1">// a[t]*x^t</span>
    <span class="k">if</span><span class="p">(</span><span class="mi">1ll</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">k</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span><span class="k">return</span><span class="p">;</span> <span class="c1">//k*t 居然能够爆int</span>
    <span class="n">a</span><span class="o">+=</span><span class="n">t</span><span class="p">;</span><span class="c1">// a/=x^t</span>
    <span class="kt">int</span> <span class="n">invat</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">mul</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">-</span><span class="n">t</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">invat</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">t</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">poly_ln</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">k</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">k</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1ll</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">mul</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="c1">// b*=x^kt</span>
<span class="p">}</span><span class="c1">// 若k为大数，且保证a[0]=1，传入k%mod即可</span>

<span class="kt">void</span> <span class="n">poly_sin</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)]// 保证a[0]=0 -&gt; c[0]=0 -&gt; 可以exp</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">*</span><span class="n">inv2I</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">//  P5264 开O2 2111ms 洛谷最快691ms</span>

<span class="kt">void</span> <span class="n">poly_cos</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)]// 保证a[0]=0 -&gt; c[0]=0 -&gt; 可以exp</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">poly_exp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span><span class="c1">//  P5264 开O2 2111ms 洛谷最快691ms</span>

<span class="kt">void</span> <span class="n">poly_asin</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)]// 保证a[0]=0 积分： f&#39;/(sqrt(1-f*f))</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f*f</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="c1">// f*f-1 </span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">mod</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="c1">//1-ff</span>
    <span class="n">poly_sqrt_Strong</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="c1">// sqrt(1-ff)</span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span> <span class="c1">// 1/sqrt(1-ff)</span>
    <span class="n">poly_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="c1">// f&#39;</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">//</span>
    <span class="n">poly_int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">// f&#39;/(sqrt(1-f*f))</span>
<span class="p">}</span><span class="c1">// P5265 开O2 1626ms 洛谷最快985ms</span>

<span class="kt">void</span> <span class="n">poly_atan</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">){</span><span class="c1">//a[exn(n+n-1)] // 保证a[0]=0 积分： f&#39;/(sqrt(1-f*f))</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="n">poly_cpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">// f*f</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">mod</span><span class="p">);</span><span class="c1">// f*f+1 </span>
    <span class="n">poly_inv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span> <span class="c1">// 1/(f*f+1)</span>
    <span class="n">poly_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">// f&#39;</span>
    <span class="n">poly_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="c1">//</span>
    <span class="n">poly_int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">// f&#39;/(f*f+1)</span>
<span class="p">}</span><span class="c1">// P5265 开O2 1626ms 洛谷最快985ms</span>

<span class="kt">int</span><span class="o">*</span><span class="n">segtree</span><span class="p">[</span><span class="n">maxn</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">],</span><span class="n">segtreebuf</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="n">lgmaxn</span><span class="p">];</span>
<span class="kt">void</span> <span class="n">zeropoint_to_poly</span><span class="p">(</span><span class="kt">int</span> <span class="n">rt</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span> <span class="c1">// T(n)=2*T(n/2)+nlg(n)= nlg(n)</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">t1</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rt</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">segtreebuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="c1">// auto ini</span>
    <span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">=</span><span class="n">segtreebuf</span><span class="o">+</span><span class="n">segtreebuf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">segtreebuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">mod</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">zeropoint_to_poly</span><span class="p">(</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
        <span class="n">zeropoint_to_poly</span><span class="p">(</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">mid</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">mid</span><span class="p">);</span>
        <span class="n">poly_cpy</span><span class="p">(</span><span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">poly_mul</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">],</span><span class="n">n</span><span class="o">-</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">poly_cpy</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="p">],</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">已知x0 x1 x2 ...</span>
<span class="cm">已知f(x)=a0x^0+a1x^1+a2x^2+...</span>
<span class="cm">求b0=f(x0),f(x1),f(x2)...</span>
<span class="cm">zeropoint_to_poly(1,)</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="n">poly_to_point</span><span class="p">(</span><span class="kt">int</span> <span class="n">rt</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">bn</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">c</span><span class="p">){</span> <span class="c1">//T(n)=2*T(n/2)+nlg(n)=nlg(n)</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">buf</span><span class="p">[</span><span class="n">maxn</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">],</span><span class="o">*</span><span class="n">d</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span><span class="n">f</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bn</span><span class="o">&lt;=</span><span class="mi">200</span><span class="o">&amp;&amp;</span><span class="n">n</span><span class="o">&lt;=</span><span class="mi">200</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">bn</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">--</span><span class="p">)</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="mi">1ll</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">d</span><span class="o">+=</span><span class="n">n</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&gt;</span><span class="n">bn</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">poly_div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="p">],</span><span class="n">bn</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">d</span><span class="p">);</span><span class="c1">// nlg(n) </span>
            <span class="n">a</span><span class="o">=</span><span class="n">d</span><span class="p">;</span> <span class="n">n</span><span class="o">=</span><span class="n">bn</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="n">bn</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">poly_to_point</span><span class="p">(</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
        <span class="n">poly_to_point</span><span class="p">(</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="n">mid</span><span class="p">,</span><span class="n">bn</span><span class="o">-</span><span class="n">mid</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="n">mid</span><span class="p">);</span>
        <span class="n">d</span><span class="o">-=</span><span class="n">n</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c1">//时间卡边界上，不过刚刚好</span>

<span class="c1">//  拉格朗日插值法 </span>
<span class="kt">int</span> <span class="n">facinv</span><span class="p">[</span><span class="n">maxn</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>
<span class="kt">void</span> <span class="n">facinv_ini</span><span class="p">(){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fac</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">maxn</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">,</span><span class="n">fac</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">fac</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">facinv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">fac</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">lagrange</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">var</span><span class="p">){</span><span class="c1">// y=f(x) 已知f(x0) f(x1) ... f(xn) 计算 f(var) O(n^2)</span>
    <span class="kt">int</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">t1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="n">t1</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">t1</span><span class="o">*</span><span class="p">(</span><span class="n">var</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
            <span class="n">t2</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">t2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">invt2</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
        <span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1ll</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t1</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">invt2</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">lagrange</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span><span class="c1">// O(n) n次多项式有n+1项 y[0]...y[n] -&gt; y[x]</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">prepre</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">suf</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="o">*</span><span class="n">pre</span><span class="o">=</span><span class="n">prepre</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">pre</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">suf</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="n">suf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">suf</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">x</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">up</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">suf</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">down</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">facinv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">facinv</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1ll</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">up</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">down</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// </span>
<span class="kt">void</span> <span class="n">lagrange_dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">rt</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">a</span><span class="p">){</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">buf</span><span class="p">[</span><span class="n">maxn</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">],</span><span class="o">*</span><span class="n">b</span><span class="o">=</span><span class="n">buf</span><span class="p">;</span>
    <span class="n">b</span><span class="o">+=</span><span class="n">n</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">lagrange_dfs</span><span class="p">(</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
        <span class="n">lagrange_dfs</span><span class="p">(</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">mid</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">mid</span><span class="p">,</span><span class="n">g</span><span class="o">+</span><span class="n">mid</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
        <span class="n">poly_mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">],</span><span class="n">n</span><span class="o">-</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">poly_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">mid</span><span class="p">,</span><span class="n">segtree</span><span class="p">[</span><span class="n">rt</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">reduce</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mod</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">b</span><span class="o">-=</span><span class="n">n</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">lagrange</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">){</span> <span class="c1">// 多项式插值到系数表示法</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span> <span class="c1">// yi/gi*pord(x-xj) j!=i</span>
    <span class="n">zeropoint_to_poly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">poly_der</span><span class="p">(</span><span class="n">segtree</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">// b-&gt; h&#39;</span>
    <span class="n">poly_to_point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="c1">//c-&gt;h&#39;(x) 多点求值 洛必达法则</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1ll</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">mod</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">zeropoint_to_poly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="n">lagrange_dfs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">read</span><span class="p">(){</span>
    <span class="k">register</span> <span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="kt">char</span> <span class="n">ch</span><span class="o">=</span><span class="n">getchar</span><span class="p">();</span>
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">)){</span><span class="k">if</span><span class="p">(</span><span class="n">ch</span><span class="o">==</span><span class="sc">&#39;-&#39;</span><span class="p">)</span><span class="n">f</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span><span class="n">ch</span><span class="o">=</span><span class="n">getchar</span><span class="p">();}</span>
    <span class="k">while</span><span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">)){</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ch</span><span class="o">-</span><span class="sc">&#39;0&#39;</span><span class="p">;</span><span class="n">ch</span><span class="o">=</span><span class="n">getchar</span><span class="p">();}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="nl">x:</span><span class="o">-</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
    <span class="n">dft_ini</span><span class="p">();</span><span class="n">inv_ini</span><span class="p">();</span> <span class="c1">// all_poly</span>
    <span class="c1">// facinv_ini();// 简单的lagrange需要，复杂的不需要</span>

    <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="n">read</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">read</span><span class="p">();</span>
    <span class="n">poly_ln</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>
</pre>
        </div>
    </div>

</div>
<script type="text/javascript" src="/ACM/js/web_end.js"></script>

</html>