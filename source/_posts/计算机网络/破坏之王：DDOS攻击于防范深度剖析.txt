---
date: 2021/09/06 21:41:00
update: 2021/09/06 21:41:00
typora-root-url: ../../../source
---

![截屏2021-09-06 下午9.42.08](/images/image-2021-09-06-21.42.08.000.png)

# 1. 笔者序

这篇Blog记录了笔者对《破坏之王： DDoS攻击与防范深度剖析》的学习记录，贡献出来和大家一起学习。

为什么学这个，笔者的服务在2021年9月4日晚上遭受了惨重的DDoS攻击，攻击者使用了100多台肉鸡，对笔者对服务进行了持续的CC攻击，最终导致产生了18TB的流量，这部分费用总计高达4000元人民币，当然在腾讯工作人员的积极帮助下，对这笔费用进行了处理，笔者也不用对这些费用进行支付，所以笔者在此由衷地感谢腾讯云团队，另外也感谢笔者的大学室友，谢谢你们的帮助。



# 2. DDoS攻击的来源

## 2.1. 僵尸程序与僵尸网络

僵尸程序就是可以控制计算机的一些程序，这些程序不一定是恶意的。僵尸程序可以自发性的进行传播，高度可控，且自带加密。



由分布在大面积计算机上的僵尸程序组合在一起所形成的大型网络。僵尸主人可以控制整个僵尸网络。

>僵尸网络的另一个特点是，控制者在发布指令后，就可以断开与僵尸网络的连接。之后，控制指令会在僵尸程序之间自行传播和执行。因此，僵尸主机能够在控制者很少或不插手的情况下协同合作，共同完成一项任务。



## 2.2. 僵尸网络的组建

- 感染传播，僵尸程序的感染手段和蠕虫、木马等无差别。
- 安装执行， 僵尸程序会进行自我复制，开机自启，隐藏自身。

- 接入僵尸网络， 当僵尸程序安装并隐藏以后，就会构建`C&C`通道加入僵尸网络。
- 命令执行，接入僵尸网络的僵尸程序就开始执行僵尸主人的指令，或者向僵尸主人发送心跳以等待僵尸主人的命令。

## 2.3. 僵尸网络的类型

### 2.3.1. IRC型僵尸网络

僵尸网络的拓扑图如下，僵尸主人和C&C服务器进行通信，僵尸网络和C&C服务器进行通信。僵尸主人向C&C服务下发指令，C&C服务器向僵尸网络下发指令。

> ![](/images/image-2021-09-06-23.13.00.000.png)



当然呢这个架构有很多问题，首先C&C服务器存在单点故障问题，然后防御者可以伪装成IRC僵尸网络的一员，从而监控整个僵尸网络。

### 2.3.2. HTTP型僵尸网络

HTTP型僵尸网络的拓扑如下，对于IRC型僵尸网络，HTTP型可以选择更多的通信端口（IRC通信端口是固定的）， 另外僵尸网络的控制流量（心跳）会淹没在大量的WEB通信中。

> ![](/images/image-2021-09-06-23.23.00.000.png)

### 2.3.3. P2P型僵尸网络

P2P型僵尸网络有了很大的提升，首先C&C服务器不再存在单点故障问题，P2P协议也没有什么特征，很难发现僵尸网络的踪迹。

P2P型僵尸网络中有4个角色，僵尸主人，C&C服务器，Servent服务器，Client服务器。

Servent服务器主要负责执行指令和分发指令，因为他们具有公网IP

Client服务器主要负责执行指令。

> ![](/images/image-2021-09-06-23.29.00.000.png)

主要介绍一下半分布式P2P僵尸网络，Servent会维护一个有限的链表，其中写着其他Servent的IP

在Servent被感染时，需要攻击者将通过硬编码的方式将一部分其他Servent的IP写入，当Servent启动以后，会去连接自己已知的Servent，并将他们所知道的其他的Servent写入自己的链表，当链表满了的时候，会直接覆盖最老的IP，这样可以保证链表中都是比较新的IP。

这有点像IP协议了，IP协议中每台机器都没有全局路由表，但是他们可以通过局部路由表实现所有的寻路功能。

当僵尸主人下发指令的时候，有C&C服务器下发，进而Servent互相下发（重复则丢弃），最后到Client

这样的架构，如果一个僵尸节点被捕获，也无法窥探整个僵尸网络的全貌，就是一些僵尸主机被封杀，也不会影响到僵尸网络。这就是集群。

## 2.4. 僵尸网络的用途

DDoS、发垃圾邮件、窃取隐私、抢占系统资源（挖矿）



# 3. DDoS攻击的方法

## 3.1. 攻击网络资源

### 3.1.1. 直接攻击

使用僵尸网络向被攻击者发送大量的网络数据包，以占满目标的带宽，从而达到拒绝服务的效果。

这些攻击手段主要包括ICMP/IGMP洪水攻击和UDP洪水攻击两种。

```mermaid
graph LR
  僵尸网络 --发送ICMP/IGMP/UDP包-->   被攻击者
```



- 在ICMP洪水攻击中，直接发送大量ICMP包

- 在IGMP洪水攻击中，直接发送大量IGMP包

- 在UDP洪水攻击中，因为UDP包的大小是不固定的，所以分为小包和大包攻击，小包攻击指的是使用64字节（以太网上传输的最小数据帧）的数据包，小包攻击将导致各种网络设备对数据包进行检查、校验，这直接消耗了基础网络设备的处理能力。大包攻击指的是使用1500字节的数据包，这个大小将导致UPD包被网络设备进行分片重组，也消耗了基础网络设备的处理能力。

### 3.1.2. 反射和放大攻击

反射的原理主要是依靠IP欺骗，利用一些网络协议中的应答数据包来实施攻击。

```mermaid
graph LR
  僵尸网络 --<span>发送一些网络协议的请求包<br>并进行IP欺骗</span>--> 反射器 --产生应答消息-->   被攻击者
```

// TODO 开Blog介绍NTP协议，介绍DNS协议

- ACK反射攻击，直接作用于TCP协议，发送SYN消息，反射器就向被攻击者发送了ACK应答。
- DNS放大攻击，作用于DNS协议，僵尸网络发送dig查询命令，DNS服务器就向被攻击者产生了应答，由于DNS的应答数据包要比请求包大，所以僵尸网络的流量将被DNS服务器进行放大，这个倍率一般为2-10倍
- NTP放大攻击，僵尸网络发送monlist请求，NTP服务器产生的应答数据包要比请求大700倍，这将导致一次非常恐怖的袭击。
- SNMP放大攻击，



































