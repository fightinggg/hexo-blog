---
date: 2020-05-05 11:26:31
updated: 2020-05-05 11:26:31
mathjax: true
typora-root-url: ../..
---

# 架构图
在这里我遇到了很多问题，从数据库设计，到架构图设计，微服务的每个地方都很难设计，目前的设计图如下
![架构图](/images/onlineShop/架构图.png)

<!-- more -->

# 安全认证
第一个大问题就是安全性，如何保证安全，我们需要认证，在传统的系统中，我们常常使用session来实习，在微服务中，也有一些处理方案，
## 分布式session
将session储存在redis中，通过cookie来访问
## JWT
第三方鉴权系统，我们构建一个认证服务器，你做所有其他操作之前，先去认证，认证服务器会给你一个tocken，你拿着tocken当令牌来使用
## 怎么用
我还是想使用分布式session，权限有很多，我们不可能让每个微服务都去找redis取session，第一耦合大，第二加重网络负重和redis压力，我们只在zuul网关处进行身份认证，后面的微服务验证权限的时候，根据身份就可以直接判断该请求是否具备某权限了。

# 分布式事务
当我们构建了微服务以后，有一些事务是分布式的，这需要我们特殊处理,
## 两阶段提交
这个在很多分布式框架中都有体现，这里不细谈，大致上是这样，第一阶段为执行，第二阶段为提交，当所有节点的第一阶段完成以后，第二阶段才开始。
## 补偿事务
有三个阶段，第一阶段为try，会将数据全部冻结，第二阶comfirm段执行事务，如果第二阶段执行成功，直接解冻即可，如果第二阶段失败，第三阶段进行cancel解冻，和回滚一样
## 本地消息表
将事务拆分为多步，每一步执行的时候，将事务的消息也存入数据库，如操作A上执行a，B执行b，C执行c构成事务，我们把执行a和事务ABC存入机器A中，这可以利用本地事务完成，然后A把后续操作发送到消息队列中，B看到了就会执行。
## 使用执行事务的MQ
比如RocketMQ